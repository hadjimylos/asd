@model List<dbModels.Stage>

@{
    List<CanvasJSDataPoint> dataPoints = new List<CanvasJSDataPoint>();

    var groupedByStageNumber = Model.GroupBy(g => g.StageNumber).OrderBy(x => x.Key).ToList();

    groupedByStageNumber.ForEach(stageNumber =>
    {
        var currentStageNumber = stageNumber.Key;
        var numberOfProjects = stageNumber.Count();

        dataPoints.Add(new CanvasJSDataPoint("Stage " + currentStageNumber.ToString(), "", numberOfProjects, ""));
    });

    <script>
        if (typeof whenDocReady === "function") {
            // already declared, do nothing
        } else {
            function whenDocReady(fn) {
                // see if DOM is already available
                if (document.readyState === "complete" || document.readyState === "interactive") {
                    // call on next available tick
                    setTimeout(fn, 1);
                } else {
                    document.addEventListener("DOMContentLoaded", fn);
                }
            }
        }

        whenDocReady(function () {
            var chartProjectStages = new CanvasJS.Chart("projectStages", {
                animationEnabled: true,
                animationDuration: 2000,
                exportEnabled: true,
                theme: "light2", // "light1", "light2", "dark1", "dark2"
                axisY: {
                    title: "Number of Projects",
                    titleFontFamily: "Roboto-Light",
                    titleFontSize: 24,
                    titleFontColor: "#677078",
                    labelFontFamily: "Roboto-Light",
                    labelFontSize: 16,
                    labelFontColor: "#677078",
                    lineThickness: 1,
                    lineColor: "#677078",
                    tickColor: "#ffffff",
                    tickLength: 4,
                    margin: 20,
                    interval: 1,
                    gridColor: "#dee2e6"
                },
                axisX: {
                    labelFontFamily: "Roboto-Light",
                    labelFontSize: 24,
                    labelFontColor: "#677078",
                    lineThickness: 1,
                    lineColor: "#677078",
                    tickColor: "#ffffff",
                    tickLength: 8,
                    margin: 0
                },
                toolTip: {
                    enabled: true,
                    shared: true,
                    fontFamily: "Roboto-Light",
                    fontSize: 16,
                    fontColor: "#677078",
                    borderThickness: 2,
                    cornerRadius: 5,
                    contentFormatter: function (e) {
                        return "<div class='chartTooltip'>"
                            + "<div class='title'>Information</div>"
                            + "<div>Stage: <strong>" + e.entries[0].dataPoint.label + "</strong></div>"
                            + "<div>Projects: <strong>" + e.entries[0].dataPoint.y + "</strong></div>"
                            + "</div>"
                    }
                },
                data: [{
                    type: "column",
                    cursor: "pointer",
                    indexLabel: "{y}",
                    indexLabelFontFamily: "Roboto-Light",
                    indexLabelFontSize: 24,
                    indexLabelFontWeight: "bold",
                    indexLabelFontColor: "#dee2e6",
                    indexLabelPlacement: "outside",
                    dataPoints: @Html.Raw(JsonConvert.SerializeObject(dataPoints))
                }]
            });

            chartProjectStages.render();
        });
    </script>
    <style>
        .chartTooltip {
            padding: 4px 8px;
        }

            .chartTooltip .title {
                font-family: "Roboto-Black";
                font-weight: 900;
                padding-bottom: 4px;
                margin-bottom: 8px;
                border-bottom: 1px solid #677078;
            }

                .chartTooltip .title:before {
                    font-family: 'Font Awesome 5 Free';
                    content: '\f05a';
                    margin-right: 8px;
                }
    </style>
    <div id="projectStages" style="height: 600px; width: 100%; margin-top: 48px;"></div>
}
