@model List<dbModels.ProjectDetail>

@{
    ViewData["Title"] = "VBPD Projects";
    Layout = "_VbpdProjectLayout";
}

<div class="actions-component">
    <div class="wrapper">
        <div class="header">
            <h1><i class="fas fa-home"></i> @ViewData["Title"]</h1>
        </div>
        <div class="actions">
            <div class="action"><a class="btn green" href="create"><i class="fas fa-plus"></i> Create new VBPD Project</a></div>
        </div>
    </div>
</div>

@if (Model.Count > 0)
{
    <div style="display: flex; align-items: center;">
        <label for="projects" style="margin-right: 8px;">Select Project:</label>
        <select class="select2" id="projectsList" style="width: 400px;">
            <option value="0" disabled selected>-- Select --</option>
            @foreach (var modelItem in Model) {
                <option value="@modelItem.ProjectId">@modelItem.Project.Name</option>
            }
        </select>
        <button class="btn green" style="margin-left: 8px;" onclick="projectRedirect()">Go</button>
        <script>
            function projectRedirect() {
                window.location.href = 'projects/' + document.getElementById('projectsList').value;
            }
        </script>
    </div>
    <div class="list-component">
        <div class="wrapper">
            <div class="title">
                <div>Project Name</div>
                <div>Status</div>
                <div>State</div>
                <div>Design Authority</div>
                <div>Project Process Type</div>
                <div>Export Control Code</div>
                <div>Sales Regions</div>
                <div>Sales Force</div>
                <div>Category</div>
                <div>Create Date</div>
            </div>
            <div class="items" style="max-height: 200px; overflow: auto;">
                @foreach (var modelItem in Model)
                {
                    var countGates = modelItem.Project.GateHistory.Count();
                    var stages = modelItem.Project.StageHistory.Select(s => s.StageNumber);
                    var maxNum = stages.Max();
                    var isLite = modelItem.ProjectCategoryTagId == 219;
                    var displayNum = isLite ? ((char)(maxNum + 64)).ToString() : maxNum.ToString();
                    var currentState = countGates == stages.Count() ? $"Gate { displayNum }" : $"Stage { displayNum }";

                    <a class="item" href="projects/@modelItem.ProjectId">
                        <div class="item-wrapper">
                            <div>@modelItem.Project.Name</div>
                            <div>@modelItem.Project.ProjectStateHistory.OrderByDescending(o => o.CreateDate).First().ProjectState.ToString()</div>
                            <div>@currentState</div>
                            <div>@modelItem.DesignAuthority.Name</div>
                            <div>@modelItem.ProjectProcessType</div>
                            <div>@modelItem.ExportControlCode</div>
                            <div>@Helpers.GetDelimited(modelItem.SalesRegions.Select(s => s.SalesRegion.Name).ToList())</div>
                            <div>@modelItem.Salesforce</div>
                            <div>@modelItem.ProjectCategory.Name</div>
                            <div>@modelItem.CreateDate</div>
                        </div>
                    </a>
                }
            </div>
        </div>
    </div>
    <div class="layout-horrizontal-component">
        <div class="wrapper">
            <div class="sections">
                <div class="section-statuses" style="width: 33%">
                    <div class="actions-component">
                        <div class="wrapper">
                            <div class="header">
                                <h1><i class="fas fa-chart-pie"></i> Project Statuses</h1>
                            </div>
                        </div>
                    </div>
                    <partial name="_ProjectStatus" />
                </div>
                <div class="section-stages" style="width: 66%">
                    <div class="actions-component">
                        <div class="wrapper">
                            <div class="header">
                                <h1><i class="fas fa-signal"></i> Project Stages</h1>
                            </div>
                        </div>
                    </div>
                    <partial name="_ProjectStages" />
                </div>
            </div>
        </div>
    </div>
}
else
{
    @Html.Partial("_NoData")
}
