@model List<FileForm>

@{
    ViewData["Title"] = "Edit Stage Files";
    Layout = "_VbpdProjectDetailLayout";
    int projectId = int.Parse(Helpers.GetRouteValue(Context.Request, "projectId"));
    int stageNumber = int.Parse(Helpers.GetRouteValue(Context.Request, "stageNumber"));
    var uploads = (List<dbModels.StageFile>)ViewBag.Uploaded;
}

<div class="actions-component">
    <div class="wrapper">
        <div class="header">
            @if (Model.Count == 0) {
                <h1 class="text-black"><i class='fas fa-check-circle'></i> All Stage Files Uploaded</h1>
            }
            else {
                <h1 class="text-red"><i class='fas fa-exclamation-circle'></i> @Model.Count Stage Files Remaining</h1>
            }
        </div>
    </div>
</div>

@if (Model.Count > 0) {
    <form class="form-component" enctype="multipart/form-data" method="post" action="/projects/@projectId/stages/@stageNumber/files/edit">
        @Html.AntiForgeryToken()
        <div class="wrapper">
            <input type="submit" class="data btn" value="Submit" />
            <div class="fields">
                @for (int i = 0; i < Model.Count; i++) {
                    <input type="hidden" asp-for="@Model[i].TagId">
                    <input type="hidden" asp-for="@Model[i].TagDescription">
                    <input type="hidden" asp-for="@Model[i].IsLocation">

                    <div class="field">
                        <div class="layout-horrizontal-component">
                            <div class="wrapper">
                                <div class="sections">
                                    <div class="section">
                                        <div class="label">Description</div>
                                        <input class="data" asp-for="@Model[i].Description" />
                                        <ul class="errors">
                                            @Html.Partial("_FieldErrors", $"[{i}].Description")
                                        </ul>
                                    </div>
                                    <div class="section">
                                        @if (Model[i].IsLocation) {
                                            <div class="label">Location: @Model[i].TagDescription</div>
                                            <input class="data" asp-for="@Model[i].Location" />
                                            <ul class="errors">
                                                @Html.Partial("_FieldErrors", $"[{i}].Location")
                                            </ul>
                                        }
                                        else {
                                            <div class="label">@Model[i].TagDescription</div>
                                            <input class="file-upload" asp-for="@Model[i].File" />
                                            <label asp-for="@Model[i].File" class="data">
                                                <span></span>
                                                <strong><i class="fas fa-upload"></i> Choose a file...</strong>
                                            </label>
                                            <ul class="errors">
                                                @Html.Partial("_FieldErrors", $"[{i}].File")
                                            </ul>
                                        }


                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </form>
}

@if (uploads.Count > 0) {
    @if (Model.Count != 0) {
        <div class="actions-component">
            <div class="wrapper">
                <div class="header">
                    <h1><i class="fas fa-clipboard-list"></i> Files Uploaded (@uploads.Count)</h1>
                </div>
            </div>
        </div>
    }

    <div class="list-component">
        <div class="wrapper">
            <div class="title">
                <div>File Type</div>
                <div>Download</div>
                <div>Description</div>
                <div>Created</div>
                <div>Uploaded By</div>
                <div><!-- placeholder for delete actions --></div>
            </div>
            <div class="items">
                @foreach (var upload in uploads) {
                    <div class="item">
                        <div class="item-wrapper">
                            <div>@(upload.IsLocation ? $"Location: {upload.FileTag.Name}" : upload.FileTag.Name)</div>
                            @if (upload.IsLocation) {
                                <div>@upload.Url</div>
                            }
                            else {
                                <a href="/projects/@projectId/stages/@stageNumber/files/download?id=@upload.Id" target="_blank">
                                    <i class="fas fa-download fa-lg"></i>
                                </a>
                            }
                            <div>@upload.Description</div>
                            <div>@upload.CreateDate</div>
                            <div>@upload.ModifiedByUser</div>
                            <div class="actions">
                                <form method="post" action="/projects/@projectId/stages/@stageNumber/files/delete">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="fileid" value="@upload.Id" />
                                    <input type="hidden" name="url" value="@upload.Url" />
                                    <button type="submit" class="btn red"><i class="fas fa-trash-alt"></i> Delete</button>
                                </form>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
}
