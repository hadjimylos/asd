@model StageFileForm

@{
    ViewData["Title"] = "Edit Stage Files";
    Layout = "_VbpdProjectDetailLayout";
    int projectId = int.Parse(Helpers.GetRouteValue(Context.Request, "projectId"));
    int stageNumber = int.Parse(Helpers.GetRouteValue(Context.Request, "stageNumber"));
    var uploads = (List<dbModels.StageFile>)ViewBag.Uploaded;
}

<div class="actions-component">
    <div class="wrapper">
        <div class="header">
            @if (Model.FileUploadDropdown.Count == 0)
            {
                <h1 class="text-black"><i class='fas fa-check-circle'></i> All Stage Files Uploaded</h1>
            }
            else
            {
                <h1 class="text-red"><i class='fas fa-exclamation-circle'></i> @Model.FileUploadDropdown.Count Stage Files Remaining</h1>
            }
        </div>
    </div>
</div>

@if (Model.FileUploadDropdown.Count > 0)
{
    <form class="form-component" enctype="multipart/form-data" method="post" action="/vbpd-projects/@projectId/stages/@stageNumber/files/edit">
        @Html.AntiForgeryToken()
        <div class="wrapper">
            <div class="fields">
                <select asp-for="@Model.TagId" asp-items="@Model.FileUploadDropdown" class="data select2">
                    <option hidden disabled selected>-- Select --</option>
                </select>
                <input type="hidden" name="@Model.TagId" />
                <ul class="errors">
                    @Html.Partial("_FieldErrors", "TagId")
                </ul>
                <input class="file-upload" type="file" id="files" name="stageFiles" />

                <label for="files" class="data">
                    <span></span>
                    <strong><i class="fas fa-upload"></i> Choose a file...</strong>
                </label>

                <ul class="errors">
                    @Html.Partial("_FieldErrors", "FileUploadDropdown")
                </ul>
                <div class="field">
                    <div class="label">Description</div>
                    <input class="data" type="text" name="description" />
                    <ul class="errors">
                        @Html.Partial("_FieldErrors", "Description")
                    </ul>
                </div>
            </div>
            <input type="submit" class="data btn" value="Submit" />
        </div>
    </form>
}

@if (uploads.Count > 0)
{
    @if (Model.FileUploadDropdown.Count != 0)
    {
        <div class="actions-component">
            <div class="wrapper">
                <div class="header">
                    <h1><i class="fas fa-clipboard-list"></i> Files Uploaded (@uploads.Count)</h1>
                </div>
            </div>
        </div>
    }

    <div class="list-component">
        <div class="wrapper">
            <div class="title">
                <div>File Type</div>
                <div>Download</div>
                <div>Description</div>
                <div>Created</div>
                <div>Uploaded By</div>
                <div><!-- placeholder for delete actions --></div>
            </div>
            <div class="items">
                @foreach (var upload in uploads)
                {
                    <div class="item">
                        <div class="item-wrapper">
                            <div>@upload.FileTag.Name</div>
                            <a href="@upload.Url" target="_blank">
                                <i class="fas fa-download fa-lg"></i>
                            </a>
                            <div>@upload.Description</div>
                            <div>@upload.CreateDate</div>
                            <div>@upload.ModifiedByUser</div>
                            <div class="actions">
                                <form method="post" action="/vbpd-projects/@projectId/stages/@stageNumber/files/delete">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="fileid" value="@upload.Id" />
                                    <input type="hidden" name="url" value="@upload.Url" />
                                    <button type="submit" class="btn red"><i class="fas fa-trash-alt"></i> Delete</button>
                                </form>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
}
